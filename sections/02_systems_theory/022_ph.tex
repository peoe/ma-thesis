\section{\acl{PH} Systems}\label{sec:phltis}

In the previous section, we saw how we can model dynamical systems through the lens a system generating an output under the action of an external control.
This idea can be further extended upon by incorporating physical properties into the description of the underlying dynamical systems through so-called ports, entities that describe how the model's internal states interact with each other and the environment.
We first give a detailed description of \ac{LTI} \ac{PH} \acp{DAE} before mentioning more generalized versions as additional context.
In the process, we formalize the notion of passivity or energy conservation as mentioned in Chapter~\ref{chap:introduction}.
Further, we explicitly note that from now on we consider the system matrices to be real-valued, in contrast to the complex-valued definitions in the previous section.
The main difference here is that in the chapter on \ac{MOR} methods, the algorithms guarantee a real reduced realization realization as long as we use complex conjugate sample points, and hence we can assume real matrices from now on w.l.o.g., cf.~\cite{Gugercin2008}.

These following remarks closely follow~\cite[Definition~4.9]{Mehrmann2022}.
In \ac{PH} systems, we split the state interaction matrix $A \in \bb{R}^{m \times n}$ into two matrices $J, R \in \bb{R}^{m \times m}$, and a state transformation matrix $Q \in \bb{R}^{m \times n}$.
In this split, it is very useful if $Q$ has full rank because some of the following calculations will be much simpler, and otherwise the system can grow unboundedly as pointed out in~\cite[Remark~4.10]{Mehrmann2022}.
The $J$ matrix is responsible for preserving energy in the system, reflected in the skew-symmetry of the matrix $-J = J\trans$, a property often encountered in Hamiltonian Mechanics.
The $R$ matrix on the other hand dissipates energy within the internal states, which can reflect e.g.\ friction, resistance, or chemical reactions.
We consider $R$ to be a symmetric positive semidefinite matrix, denoted $R \in \mcl{S}_{\curlyeqsucc}^{n \times n}(\bb{R})$.
We then couple these matrices to the original \ac{LTI} formulation in the state matrix
\begin{equation*}
    A = (J - R)Q,
\end{equation*}
such that the energy dissipation matrix takes the correct sign when putting physical formulations into the \ac{PH} framework.
Apart from the matrices coupling the internal states we apply similar splits to the matrices relating to the controls and outputs of the system
\begin{equation*}
    B = G - P,\quad C = (G + P)\trans Q,\quad D = S - N.
\end{equation*}
Furthermore, we require that all these matrices conform to the additional structural constraints
\begin{equation*}
    \begin{pmatrix}
        Q & 0 \\
        0 & \id
    \end{pmatrix}\trans
    \begin{pmatrix}
        R & P \\
        P\trans & S
    \end{pmatrix}
    \begin{pmatrix}
        Q & 0 \\
        0 & \id
    \end{pmatrix}
    \in \mcl{S}_{\curlyeqsucc}^{(n + q) \times (n + q)},\quad -N = N\trans \in \bb{R}^{q \times q},\quad G \in \bb{R}^{n \times q}.
\end{equation*}

We could now rephrase~\eqref{eq:lti} in terms of these matrices, however there is one more aspect to the \ac{PH} formulation we yet lack: the Hamiltonian, sometimes also referred to as (energy) storage function.
The storage function is motivated in Physics to model the total amount of energy within a system.
In our case, we restrict ourselves to a quadratic Hamiltonian formulation
\begin{equation}\label{eq:quadratic-hamiltonian}
    \mcl{H} \colon I \times \bb{R}^{n} \to \bb{R},\quad \mcl{H}(t, x) \mapsto \frac{1}{2} x(t)\trans Q\trans E x(t).
\end{equation}

\begin{definition}[{Cf.~\cite[Definition~4.9]{Mehrmann2022}}]\label{def:phlti}
    A \acl{PH} \ac{LTI} system with quadratic Hamiltonian consists of a system of equations
    \begin{equation}\label{eq:phlti}
        \Sigma_{\msc{phlti}} \colon \left\lbrace
        \begin{aligned}
            E \dot{x}(t) &= (J - R) Q x(t) + (G - P) u(t), \\
            y(t) &= (G + P)\trans Q x(t) + (S - N) u(t)
        \end{aligned}
        \right.
    \end{equation}
    together with a Hamiltonian $\mcl{H}(t, x) = \frac{1}{2} x(t)\trans Q\trans E x(t)$ if the system matrices $E, Q \in \bb{R}^{m \times n}, J, R \in \bb{R}^{m \times m}$, $G, P \in \bb{R}^{m \times q}$, and $S, N \in \bb{R}^{q \times q}$ satify the properties
    \begin{equation}\label{eq:ph-matrix-structure}
        -J = J\trans,\quad -N = N\trans,\quad
        \begin{pmatrix}
            Q & 0 \\
            0 & \id
        \end{pmatrix}\trans
        \begin{pmatrix}
            R & P \\
            P\trans & S
        \end{pmatrix}
        \begin{pmatrix}
            Q & 0 \\
            0 & \id
        \end{pmatrix}
        \in \mcl{S}_{\curlyeqsucc}^{(n + q) \times (n + q)}.
    \end{equation}
\end{definition}

\begin{remark}
    Because we inherently derived this representation from the matrices $(A, B, C, D, E)$, we can in turn describe any \ac{PH} \ac{LTI} system $\Sigma_{\msc{phlti}}$ as an \ac{LTI} system $\Sigma_{\msc{lti}}$ by defining its system matrices to be
    \begin{equation*}
        A \coloneqq (J - R) Q,\quad B \coloneqq G - P,\quad C = (G + P)\trans Q,\quad D = S - N.
    \end{equation*}
\end{remark}

\begin{remark}[{Adapted from~\cite[Section~4.3]{Mehrmann2022}}]
    In Definition~\ref{def:phlti}, we stated the general definition of a \ac{PH} system.
    In practice, it is common to transform the system such that the $Q$ matrix is reduced to $Q = \id$.
    If $Q$ has full rank, then this is achieved by multiplying the first equation in~\eqref{eq:phlti} by $Q\trans$ from the left and defining
    \begin{equation*}
        H \coloneqq Q\trans E,\quad \tilde{J} \coloneqq Q\trans J Q,\quad \tilde{R} \coloneqq Q\trans R Q, \tilde{G} \coloneqq Q\trans G, \tilde{P} \coloneqq Q\trans P.
    \end{equation*}
    Using this substitution, we can write our original \ac{PH} system as
    \begin{equation*}
        \Sigma \colon \left\lbrace
        \begin{aligned}
            H \dot{x}(t) &= (\tilde{J} - \tilde{R}) x(t) + (\tilde{G} - \tilde{P}) u(t), \\
            y(t) &= (\tilde{G} + \tilde{P})\trans x(t) + (S - N) u(t),
        \end{aligned}
        \right.
    \end{equation*}
    in which the matrix $H$ directly represents the Hamiltonian function by inserting $H = Q\trans E$ into~\eqref{eq:quadratic-hamiltonian}
    \begin{equation*}
        \mcl{H}(t, x) = x\trans H x.
    \end{equation*}
\end{remark}

\begin{remark}
    For a nonzero direct feedthrough term $D \coloneqq S - N$, we can reformulate any \ac{PH} \ac{LTI} system $\Sigma_{\msc{phlti}}$ such that we eliminate the feedthrough term.
    According to~\cite[Theorem~2.13]{Mehrmann2022}, we begin by decomposing $D$ into $D = U_D \begin{pmatrix}
        D_1 & 0 \\
        0 & 0
    \end{pmatrix} U_D\trans$ for some orthogonal matrix $U_D$ and the regular component $D_1$.
    We then partition the control-state components along the corresponding coordinates such that
    \begin{equation*}
        (G - P) U_D = \begin{pmatrix}
            G_1 - P_1 & G_2 - P_2
        \end{pmatrix},\quad U_D\trans u = \begin{pmatrix}
            u_1 \\
            u_2
        \end{pmatrix},\quad U_D\trans y = \begin{pmatrix}
            y_1 \\
            y_2
        \end{pmatrix}.
    \end{equation*}
    Continuing, we calculate that we can substitute a new state variable $z \coloneqq D_1 u_1 + P_1\trans x$ into the system
    \begin{equation}\label{eq:feedthrough-elimination}
        \Sigma_{\msc{phlti}} \colon \left\lbrace
        \begin{aligned}
            \begin{pmatrix}
                E & 0 \\
                0 & 0
            \end{pmatrix} \begin{pmatrix}
                x \\
                z
            \end{pmatrix} &= \begin{pmatrix}
                J - R & 0 \\
                D_1\inv P_1\trans & -D_1\inv
            \end{pmatrix} \begin{pmatrix}
                x \\
                z
            \end{pmatrix} + \begin{pmatrix}
                G_1 - P_1 \\
                \id
            \end{pmatrix} u_1 + \begin{pmatrix}
                G_2 \\
                0
            \end{pmatrix} u_2, \\
            y_1 &= \begin{pmatrix}
                G_1\trans & \id
            \end{pmatrix} \begin{pmatrix}
                x \\
                z
            \end{pmatrix}, \\
            y_2 &= G_2\trans x.
        \end{aligned}
        \right.
    \end{equation}
    As a last step, we multiply the state equation in~\eqref{eq:feedthrough-elimination} from the left with the matrix $\begin{pmatrix}
        \id & P_1 \\
        0 & \id
    \end{pmatrix}$, and finally partition the state block matrix appropriately such that~\cite[Theorem~4.12]{Mehrmann2022} guarantees that the new system is once again \ac{PH}.
\end{remark}

Because \ac{PH} systems are directly motivated by the energy contained within them, we are interested in estimating the change in total energy $\mcl{H}(t)$ at any point in time $t$.
Considering the physical motivation, it makes sense to bound $\frac{\dif}{\dif t} \mcl{H}$ by the values of the control $u$ and the output $y$: the system itself preserves energy, and thus a change in energy can only take place by influx through the control or dispersal by the system's output.
In fact, we can derive a dissipation inequality thanks to the positive semidefinite system matrices as specified in~\eqref{eq:ph-matrix-structure}.
Following the notation in~\cite[Theorem~6.1]{Mehrmann2022}, we write
\begin{equation}\label{eq:dissipation-inequality}
    \mcl{H}(x(t_1)) - \mcl{H}(x(t_0)) \leq \int\limits_{t_0}^{t_1} u(\tau)\trans y(\tau) \dif \tau.
\end{equation}
If the state $x(t_0) = x_0$ contains no energy, e.\ g.\ $x_0 = 0$, and the initial time $t_0$ is $t_0 = 0$, then we can trivially transform the inequality to
\begin{equation*}
    0 \leq \mcl{H}(x(t_1)) \leq \int\limits_0^t u(\tau)\trans y(\tau) \dif \tau,
\end{equation*}
because the energy of the state $x(t_1)$ cannot be less than zero.
Additionally, while we motivated the dissipation inequality as a property of \ac{PH} systems, it is by no means restricted to \ac{PH} systems, by itself only requiring the existence of an energy storage function $\mcl{H}$ to serve as a proxy for the total system energy.

\begin{definition}\label{def:passivity}
    A system $\Sigma_\msc{lti}$ with an energy storage function $\mcl{H}$ is said to be passive if it satisfies the dissipation inequality
    \begin{equation*}
        \mcl{H}(x(t_1)) - \mcl{H}(x(t_0)) \leq \int\limits_{t_0}^{t_1} u(\tau)\trans y(\tau) \dif \tau
    \end{equation*}
    for any two points $t_0, t_1 \in I$ in time that fulfill $t_0 \leq t_1$.
\end{definition}

\begin{remark}
    Passivity is a very important property for port-based modelling of dynamical systems because it allows for the coupling of any two passive systems through a power-conserving interconnection; cf.~\cite[Section~6.4]{Mehrmann2022}.
\end{remark}

\begin{remark}
    Any passive \ac{LTI} system $\Sigma_{\msc{lti}}$ with a realization $(A, B, C, D, E)$ and a quadratic Hamiltonian $\mcl{H}(x) = x\trans H x$ allows for a \ac{PH} representation $\Sigma_{\msc{phlti}}$ if the matrix $H$ is positive semidefinite and it satisfies $\knl{H} \subseteq \knl{A}$; cf.~\cite[Theorem~7.1]{VanDerSchaft2014}.
\end{remark}

Generally speaking, Definition~\ref{def:phlti} is too restrictive because the system in Equation~\eqref{eq:phlti} only allows for coefficients that are constant in time.
To alleviate this restriction, we use the final part of this chapter to highlight three approaches to consider more general formulations.

\begin{remark}
    The first of these constitutes itself in the application of linear time-varying operators in the realization $(E, Q, J, R, G, P, N, S)$.
    This results in the following linear \ac{PH} system
    \begin{equation}\label{eq:lph}
        \Sigma_{\msc{lph}} \colon \left\lbrace
        \begin{aligned}
            E(t) \dot{x}(t) + E(t) K(t) x(t) &= (J(t) - R(t)) Q(t) x(t) + (G(t) - P(t)) u(t), \\
            y(t) &= (G(t) + P(t))\trans Q(t) x(t) + (S(t) - N(t)) u(t),
        \end{aligned}
        \right.
    \end{equation}
    with the quadratic Hamiltonian $\mcl{H}(t, x) \coloneqq \frac{1}{2} x\trans Q(t)\trans E(t) x(t)$.
    The \ac{PH} constraints on the dissipative elements $P, R$ and $S$ stay the same as for the time-invariant system $\Sigma_{\msc{phlti}}$, however the condition for the previously simply skew-symmetric $\begin{pmatrix}
        J & G \\
        -G\trans & N
    \end{pmatrix}$ shifts to the need for the differential operator $Q\trans E \frac{\dif}{\dif t} - (Q\trans J Q - Q\trans E K)$ is skew-adjoint; cf.~\cite[Definition~4.8]{Mehrmann2022}.
\end{remark}

\begin{remark}
    The second approach is very similar to~\eqref{eq:lph}, however in addition to the time dependency we also allow for the system's operators to change based on the system state as a parameter.
    After some generalizations of the state formulations which are further detailed in~\cite{Mehrmann2022}, this extension results in a nonlinear \ac{PH} system of the form
    \begin{equation}\label{eq:nlph}
        \Sigma_{\msc{nlph}} \colon \left\lbrace
        \begin{aligned}
            E(t, x) \dot{x}(t) + r(t, x) &= (J(t, x) - R(t, x)) \eta(t, x) + (G(t, x) - P(t, x)) u(t), \\
            y(t) &= (G(t, x) + P(t, x))\trans \eta(t, x) + (S(t, x) - N(t, x)) u(t),
        \end{aligned}
        \right.
    \end{equation}
    where the Hamiltonian is implicitly defined through the differential equations
    \begin{equation*}
        \pd{} \mcl{H}(t, x) = E(t, x)\trans \eta(t, x),\quad \text{ and }\quad \pd[t]{} \mcl{H}(t, x) = \eta(t, x)\trans r(t, x),
    \end{equation*}
    alongside similar constraints on the passive and dissipative components of the \ac{PH} system as were imposed in the \ac{LTI} case; cf.~\cite[Definition~4.1]{Mehrmann2022}.
\end{remark}

\begin{remark}
    For the most general representation of \ac{PH} systems, we have to take a large conceptual leap, wherefore we compel the reader interested in a more detailed discussion to refer to~\cite[Section~2.2]{VanDerSchaft2014}.
    Consider a finite-dimensional vector space $\mcl{F}$, and denote its dual space as $\mcl{E} = \mcl{F}'$ endowed with the canonical dual product ${\langle e, f \rangle}_{\mcl{E} \times \mcl{F}} = e(f)$ for the elements $f \in \mcl{F}$ and $e \in \mcl{E}$.
    We then refer to a subspace $\mcl{D} \sse \mcl{F} \times \mcl{E}$ as a Dirac structure if $\mcl{D}$ satisfies that
    \begin{enumerate}
        \item for all pairs $(f, e) \in \mcl{D}$ it holds that ${\langle e, f \rangle}_{\mcl{E} \times \mcl{F}} = 0$, and
        \item $\dim{(\mcl{D})} = \dim{(\mcl{F})}$.
    \end{enumerate}
    In this setting, we can thus define a nonlinear \ac{PH} system as a Dirac structure
    \begin{equation*}
        \mcl{D} \sse \mcl{T}_x \mcl{X} \times \mcl{T}'_x \mcl{X} \times \mcl{F}_S \times \mcl{E}_S \times \mcl{F}_R \times \mcl{E}_R \times \mcl{F}_P \times \mcl{E}_P,
    \end{equation*}
    where $\mcl{X}$ denotes an abstract state space, $\mcl{T}_x \mcl{X}$ and $\mcl{T}'_x \mcl{X}$ the respective tangent and dual tangent spaces of $\mcl{X}$, $\mcl{F}_S \times \mcl{E}_S$ an energy storing Dirac structure, $\mcl{F}_R \times \mcl{E}_R$ a dissipative Dirac structure, and $\mcl{F}_P \times \mcl{E}_P$ an external port Dirac structure.
    For a Hamiltonian function $\mcl{H} \colon \mcl{X} \to \bb{R}$, we can derive the power-balance
    \begin{equation*}
        0 = e_S\trans f_S + e_R\trans f_R + e_P\trans f_P,
    \end{equation*}
    from whom by interconnection of the separate ports we obtain the individual power-balances
    \begin{equation*}
        \frac{\dif}{\dif t} \mcl{H} = {\langle \pd{} \mcl{H}(x), \dot{x} \rangle}_{\mcl{T}_x \mcl{X} \times \mcl{X}} = -e_S\trans f_S,\quad e_R\trans f_R \leq 0,\quad \frac{\dif}{\dif t} \mcl{H} = e_R\trans f_R + e_P\trans f_P \leq e_P\trans f_P.
    \end{equation*}
\end{remark}
